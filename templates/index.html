<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>H.264 Datamosh Web Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  </head>
  <body>
    <div class="container my-4">
      <h1 class="mb-4">H.264 Datamosh Web Tool</h1>
      
      <!-- Display any flash messages to the user -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-warning" role="alert">
            {% for message in messages %}
              <p>{{ message }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
      
      <form method="POST" action="{{ url_for('process') }}" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="video1" class="form-label">Upload first video clip (Clip 1):</label>
          <input type="file" class="form-control" id="video1" name="video1" accept="video/*" required>
        </div>
        <div class="mb-3">
          <label for="video2" class="form-label">Upload second video clip (Clip 2):</label>
          <input type="file" class="form-control" id="video2" name="video2" accept="video/*" required>
        </div>
        <div class="mb-3">
          <label for="remove_spspps" class="form-label">Remove SPS/PPS (NAL types 7 &amp; 8):</label>
          <select class="form-select" id="remove_spspps" name="remove_spspps">
            <option value="yes" selected>Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <!-- Advanced Datamoshing Options -->
        <fieldset class="border p-3 mb-3">
          <legend class="w-auto px-2">Advanced Datamoshing Options</legend>
          <div class="mb-3">
            <label for="remove_iframes" class="form-label">I-frame Removal:</label>
            <select class="form-select" id="remove_iframes" name="remove_iframes">
              <option value="first" selected>Remove first I-frame</option>
              <option value="all">Remove all I-frames</option>
              <option value="none">Keep all I-frames</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="duplicate_pframes" class="form-label">Duplicate P-frames (enter number, 1 means no duplication):</label>
            <input type="number" class="form-control" id="duplicate_pframes" name="duplicate_pframes" value="1" min="1">
          </div>
          <div class="mb-3">
            <label for="duplicate_probability" class="form-label">Duplicate Probability (% chance, 0-100):</label>
            <input type="number" class="form-control" id="duplicate_probability" name="duplicate_probability" value="100" min="0" max="100">
          </div>
          <div class="mb-3">
            <label for="reorder_intensity" class="form-label">Reorder Intensity (% chance to shuffle a local window, 0-100):</label>
            <input type="number" class="form-control" id="reorder_intensity" name="reorder_intensity" value="0" min="0" max="100">
          </div>
          <div class="mb-3">
            <label for="reorder_window_size" class="form-label">Reorder Window Size (number of frames per window):</label>
            <input type="number" class="form-control" id="reorder_window_size" name="reorder_window_size" value="10" min="2">
          </div>
          <div class="mb-3">
            <label for="corrupt_pframes" class="form-label">Corrupt P-frames (% chance, 0-100):</label>
            <input type="number" class="form-control" id="corrupt_pframes" name="corrupt_pframes" value="0" min="0" max="100">
          </div>
          <div class="mb-3">
            <label for="corruption_intensity" class="form-label">Corruption Intensity (0-100):</label>
            <input type="number" class="form-control" id="corruption_intensity" name="corruption_intensity" value="50" min="0" max="100">
          </div>
          <div class="mb-3">
            <label for="drop_frame_percentage" class="form-label">Randomly Drop Frames (% chance, 0-100):</label>
            <input type="number" class="form-control" id="drop_frame_percentage" name="drop_frame_percentage" value="0" min="0" max="100">
          </div>
        </fieldset>
        <div class="mb-3">
          <label for="offset" class="form-label">Offset (seconds) to skip from start of Clip 2:</label>
          <input type="number" step="0.01" class="form-control" id="offset" name="offset" value="0.0">
        </div>
        <button type="submit" class="btn btn-primary">Process and Preview</button>
      </form>
      
      <!-- Display the processed video preview if available -->
      {% if video_url %}
      <hr class="my-4">
      <h2>Preview Datamoshed Video</h2>
      <video width="640" controls autoplay class="mb-4">
        <source src="{{ video_url }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <p>
        <a href="{{ video_url }}" class="btn btn-secondary" download>Download Video</a>
      </p>
      {% endif %}
    </div>
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
